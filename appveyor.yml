version: 0.1.{build}

pull_requests:
  do_not_increment_build_number: true

environment:
  # Avoid expensive initialization of dotnet cli, see: http://donovanbrown.com/post/Stop-wasting-time-during-NET-Core-builds
  DOTNET_SKIP_FIRST_TIME_EXPERIENCE: 1

branches:
  only:
  - dev
  - master

image:
- Ubuntu
- Visual Studio 2017

max_jobs: 1

install:
  - pwsh: ./build.ps1 -NoBuild -Bootstrap

build_script:
  - pwsh: |
      $ErrorActionPreference = "Stop"
      ./build.ps1 -Clean -Configuration Release

test_script:
  - pwsh: ./build.ps1 -NoBuild -Test

on_finish:
  - pwsh: dir *.PowerShellWorker.*.nupkg -Recurse | % { Push-AppveyorArtifact $_.FullName -FileName $_.Name }
